# [0043. è®¤è¯† package-lock.json](https://github.com/Tdahuyou/TNotes.nodejs/tree/main/notes/0043.%20%E8%AE%A4%E8%AF%86%20package-lock.json)

<!-- region:toc -->

- [1. ğŸ”— npm docs package-lock.json](#1--npm-docs-package-lockjson)
- [2. ğŸ“’ æ¦‚è¿°](#2--æ¦‚è¿°)
- [3. ğŸ“’ ç†è§£ `package-lock.json` çš„å¿…è¦æ€§](#3--ç†è§£-package-lockjson-çš„å¿…è¦æ€§)
- [4. ğŸ“’ `package-lock.json` æ–‡ä»¶ç»“æ„](#4--package-lockjson-æ–‡ä»¶ç»“æ„)
- [5. ğŸ“’ `package-lock.json` ä¼šè‡ªåŠ¨ç”Ÿæˆå’Œæ›´æ–°](#5--package-lockjson-ä¼šè‡ªåŠ¨ç”Ÿæˆå’Œæ›´æ–°)
- [6. ğŸ“’ æ³¨æ„äº‹é¡¹](#6--æ³¨æ„äº‹é¡¹)

<!-- endregion:toc -->

## 1. ğŸ”— npm docs package-lock.json

- https://docs.npmjs.com/cli/v9/configuring-npm/package-lock-json
- è¿™æ˜¯ npm çš„å®˜æ–¹å¯¹ `package-lock.json` æ–‡ä»¶çš„è¯´æ˜ã€‚

## 2. ğŸ“’ æ¦‚è¿°

- `package-lock.json` æ˜¯ npm è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ï¼Œä¸»è¦ä½œç”¨æ˜¯ **é”å®šä¾èµ–çš„å…·ä½“ç‰ˆæœ¬**ï¼Œç¡®ä¿åœ¨ä¸åŒç¯å¢ƒä¸­å®‰è£…çš„ä¾èµ–å®Œå…¨ä¸€è‡´ï¼Œ**é¿å…å› ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜**ã€‚
- å½“è¿è¡Œ `npm install` æ—¶ï¼Œ`package-lock.json` ä¼šè¢«æ›´æ–°ä»¥è®°å½•å½“å‰å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ã€‚
- **`package-lock.json` çš„æ ¸å¿ƒä½œç”¨**ï¼š
  - **é”å®šä¾èµ–çš„å…·ä½“ç‰ˆæœ¬**ï¼šæ˜ç¡®è®°å½•æ¯ä¸ªä¾èµ–åŠå…¶å­ä¾èµ–çš„ç¡®åˆ‡ç‰ˆæœ¬å·ã€‚
  - **ç”Ÿæˆä¸€è‡´çš„ä¾èµ–æ ‘**ï¼šæ— è®ºåœ¨å“ªå°æœºå™¨ä¸Šè¿è¡Œ `npm install`ï¼Œéƒ½ä¼šç”Ÿæˆç›¸åŒçš„ä¾èµ–ç»“æ„ã€‚
  - **æé«˜å®‰è£…æ•ˆç‡**ï¼šé€šè¿‡ç¼“å­˜å’Œé”å®šç‰ˆæœ¬ï¼Œå‡å°‘é‡å¤ä¸‹è½½å’Œè§£æä¾èµ–çš„æ—¶é—´ã€‚
- åœ¨å¼€å‘è¿‡ç¨‹ä¸­é€šå¸¸æ— éœ€å…³æ³¨ `package-lock.json` çš„å†…å®¹ï¼Œä½†åœ¨ä»¥ä¸‹åœºæ™¯ä¸­æŸ¥çœ‹ä¼šæœ‰æ‰€å¸®åŠ©ï¼š
  - æ’æŸ¥ä¾èµ–ç‰ˆæœ¬é—®é¢˜ã€‚
  - ä¼˜åŒ–ä¾èµ–ç»“æ„ã€‚
  - è¿›è¡Œå®‰å…¨å®¡è®¡ã€‚
    - ä½¿ç”¨å·¥å…·ï¼ˆå¦‚ `npm audit`ï¼‰æ£€æŸ¥ä¾èµ–çš„å®‰å…¨æ€§æ—¶ï¼Œ`package-lock.json` æä¾›äº†æ‰€æœ‰ä¾èµ–çš„å®Œæ•´åˆ—è¡¨å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚
    - é€šè¿‡æŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼Œå¯ä»¥å¿«é€Ÿå®šä½å­˜åœ¨å®‰å…¨æ¼æ´çš„ä¾èµ–åŠå…¶å…·ä½“ç‰ˆæœ¬ã€‚
- **æœ€ä½³å®è·µ**ï¼š
  - å§‹ç»ˆå°† `package-lock.json` æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ã€‚
  - é¿å…æ‰‹åŠ¨ä¿®æ”¹ `package-lock.json`ï¼Œé€šè¿‡ `npm install` æˆ– `npm update` æ›´æ–°ä¾èµ–ã€‚
  - å®šæœŸæ¸…ç†æ— ç”¨ä¾èµ–ï¼Œå¹¶ä½¿ç”¨å·¥å…·ï¼ˆå¦‚ `npm audit`ï¼‰æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬çš„å®‰å…¨æ€§ã€‚

## 3. ğŸ“’ ç†è§£ `package-lock.json` çš„å¿…è¦æ€§

- åœ¨ Node.js é¡¹ç›®ä¸­ï¼Œä¾èµ–ç®¡ç†æ˜¯é€šè¿‡ `package.json` æ–‡ä»¶å®Œæˆçš„ã€‚ç„¶è€Œï¼Œ`package.json` ä¸­çš„ä¾èµ–ç‰ˆæœ¬é€šå¸¸ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬èŒƒå›´ï¼ˆå¦‚ `^1.2.3` æˆ– `~1.2.3`ï¼‰ï¼Œè¿™ä¼šå¯¼è‡´åœ¨ä¸åŒç¯å¢ƒä¸­å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬å¯èƒ½ä¸åŒã€‚ä¾‹å¦‚ï¼š
  - å¼€å‘è€… A å®‰è£…äº† `1.2.5`ã€‚
  - å¼€å‘è€… B å®‰è£…äº† `1.2.8`ã€‚
  - éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶å®‰è£…äº† `1.2.10`ã€‚
- è¿™ç§å·®å¼‚å¯èƒ½å¯¼è‡´ â€”â€” **è¡Œä¸ºè¡¨ç°ä¸ä¸€è‡´** çš„é—®é¢˜ã€‚
  - **å¼€å‘ç¯å¢ƒä¸ç”Ÿäº§ç¯å¢ƒä¸ä¸€è‡´**ï¼šæŸäº›åŠŸèƒ½åœ¨å¼€å‘ç¯å¢ƒä¸­æ­£å¸¸ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‡ºç°é—®é¢˜ã€‚
  - **å›¢é˜Ÿåä½œé—®é¢˜**ï¼šå›¢é˜Ÿæˆå‘˜ä¹‹é—´ä½¿ç”¨çš„ä¾èµ–ç‰ˆæœ¬ä¸åŒï¼Œå¯¼è‡´ä»£ç è¡Œä¸ºä¸ä¸€è‡´ã€‚
- ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œnpm å¼•å…¥äº† `package-lock.json` æ–‡ä»¶ï¼Œç¡®ä¿åœ¨ä¸åŒç¯å¢ƒä¸­å®‰è£…çš„ä¾èµ–å®Œå…¨ä¸€è‡´ï¼Œ**é¿å…å› ç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡´çš„é—®é¢˜**ã€‚

## 4. ğŸ“’ `package-lock.json` æ–‡ä»¶ç»“æ„

- `package-lock.json` æ˜¯ä¸€ä¸ª JSON æ ¼å¼çš„æ–‡ä»¶ï¼Œå…¶å†…å®¹é€šå¸¸åŒ…æ‹¬ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼š
  - **é¡¶å±‚å­—æ®µ**
  - **ä¾èµ–ä¿¡æ¯**

::: code-group

```json [ç¤ºä¾‹ - é¡¶å±‚å­—æ®µ]
{
  "name": "example-project",
  "version": "1.0.0",
  "lockfileVersion": 2,
  "requires": true,
  "packages": {},
  "dependencies": {}
}
```

:::

- **`name` å’Œ `version`**ï¼šé¡¹ç›®åç§°å’Œç‰ˆæœ¬å·ï¼Œä¸ `package.json` ä¸­çš„ä¸€è‡´ã€‚
- **`lockfileVersion`**ï¼šé”å®šæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼Œç”¨äºæ ‡è¯† `package-lock.json` æ–‡ä»¶çš„æ ¼å¼ã€‚ç›®å‰å¸¸è§çš„å€¼åŠå…¶å«ä¹‰å¦‚ä¸‹ï¼š
  - **`1`**ï¼šæ—§ç‰ˆæ ¼å¼ï¼Œé»˜è®¤ç”¨äº npm v5 å’Œ v6ã€‚ä¸»è¦è®°å½•ä¾èµ–æ ‘çš„å±‚çº§ç»“æ„ï¼Œä¾èµ–è§£ææ•ˆç‡è¾ƒä½ã€‚
  - **`2`**ï¼šæ–°ç‰ˆæ ¼å¼ï¼Œé»˜è®¤ç”¨äº npm v7 å’Œ v8ã€‚å¼•å…¥äº† `packages` å­—æ®µï¼Œæä¾›æ›´å®Œæ•´çš„ä¾èµ–æ ‘ä¿¡æ¯ï¼Œæ˜¾è‘—æå‡äº†ä¾èµ–è§£ææ•ˆç‡ã€‚
  - **`3`**ï¼šæœ€æ–°æ ¼å¼ï¼Œé»˜è®¤ç”¨äº npm v9 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯æ”¯æŒéšè—é”æ–‡ä»¶ï¼ˆ`node_modules/.package-lock.json`ï¼‰ï¼Œå¹¶åŒ…å«æ›´å¤šå…ƒæ•°æ®ä»¥æ”¯æŒå¤æ‚åœºæ™¯ã€‚
- **`requires`**ï¼šæŒ‡ç¤ºæ˜¯å¦éœ€è¦è§£æä¾èµ–å…³ç³»ã€‚
- **`packages`**ï¼šè®°å½•æ‰€æœ‰ä¾èµ–åŠå…¶å­ä¾èµ–çš„å…·ä½“ä¿¡æ¯ï¼ˆnpm v7 åŠä»¥ä¸Šå¼•å…¥ï¼‰ã€‚
- **`dependencies`**ï¼šè®°å½•ä¾èµ–æ ‘çš„å±‚çº§ç»“æ„ï¼ˆnpm v6 åŠä»¥ä¸‹ä½¿ç”¨ï¼‰ã€‚

::: warning å»ºè®®å›¢é˜Ÿä½¿ç”¨çš„ npm ç‰ˆæœ¬ä¸€è‡´

- `lockfileVersion: 3` å‘åå…¼å®¹ `lockfileVersion: 2`ï¼Œä½†å»ºè®®å›¢é˜Ÿæˆå‘˜ç»Ÿä¸€ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ npmï¼Œä»¥é¿å…å› æ ¼å¼å·®å¼‚å¯¼è‡´çš„é—®é¢˜ã€‚

:::

---

::: code-group

```json [ç¤ºä¾‹ - ä¾èµ–ä¿¡æ¯]
"node_modules/vitepress": {
  "version": "1.6.3",
  "resolved": "https://registry.npmmirror.com/vitepress/-/vitepress-1.6.3.tgz",
  "integrity": "sha512-fCkfdOk8yRZT8GD9BFqusW3+GggWYZ/rYncOfmgcDtP3ualNHCAg+Robxp2/6xfH1WwPHtGpPwv7mbA3qomtBw==",
  "dev": true,
  "license": "MIT",
  "dependencies": {
    "@docsearch/css": "3.8.2",
    "@docsearch/js": "3.8.2",
    "@iconify-json/simple-icons": "^1.2.21",
    "@shikijs/core": "^2.1.0",
    "@shikijs/transformers": "^2.1.0",
    "@shikijs/types": "^2.1.0",
    "@types/markdown-it": "^14.1.2",
    "@vitejs/plugin-vue": "^5.2.1",
    "@vue/devtools-api": "^7.7.0",
    "@vue/shared": "^3.5.13",
    "@vueuse/core": "^12.4.0",
    "@vueuse/integrations": "^12.4.0",
    "focus-trap": "^7.6.4",
    "mark.js": "8.11.1",
    "minisearch": "^7.1.1",
    "shiki": "^2.1.0",
    "vite": "^5.4.14",
    "vue": "^3.5.13"
  },
  "bin": {
    "vitepress": "bin/vitepress.js"
  },
  "peerDependencies": {
    "markdown-it-mathjax3": "^4",
    "postcss": "^8"
  },
  "peerDependenciesMeta": {
    "markdown-it-mathjax3": {
      "optional": true
    },
    "postcss": {
      "optional": true
    }
  }
}
```

:::

- **`version`**ï¼šä¾èµ–çš„å…·ä½“ç‰ˆæœ¬å·ã€‚
- **`resolved`**ï¼šä¾èµ–çš„ä¸‹è½½åœ°å€ï¼ˆé€šå¸¸æ˜¯ npm çš„ CDN åœ°å€ï¼‰ã€‚
- **`integrity`**ï¼šä¾èµ–çš„å®Œæ•´æ€§æ ¡éªŒå€¼ï¼ˆé€šå¸¸æ˜¯ SHA-512 å“ˆå¸Œå€¼ï¼‰ï¼Œç”¨äºç¡®ä¿ä¾èµ–æœªè¢«ç¯¡æ”¹ã€‚
- **`dependencies`**ï¼šè¯¥ä¾èµ–çš„å­ä¾èµ–åŠå…¶ç‰ˆæœ¬ä¿¡æ¯ã€‚
- **`dev`**ï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥ä¾èµ–æ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒä¾èµ–ã€‚å¦‚æœä¸º `true`ï¼Œåˆ™è¯¥ä¾èµ–ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œä¸ä¼šè¢«æ‰“åŒ…åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚
- **`license`**ï¼šè¯¥ä¾èµ–çš„è®¸å¯è¯ç±»å‹ï¼ˆå¦‚ `MIT`ã€`Apache-2.0` ç­‰ï¼‰ï¼Œç”¨äºå£°æ˜è¯¥åŒ…çš„æ³•å¾‹ä½¿ç”¨è®¸å¯ã€‚
- **`bin`**ï¼šå®šä¹‰è¯¥ä¾èµ–æä¾›çš„å¯æ‰§è¡Œæ–‡ä»¶åŠå…¶è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ`"vitepress": "bin/vitepress.js"` è¡¨ç¤ºå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œ `vitepress` æ¥è°ƒç”¨ `bin/vitepress.js` æ–‡ä»¶ã€‚
- **`peerDependencies`**ï¼šåŒè¡Œä¾èµ–ï¼Œåˆ—å‡ºå½“å‰åŒ…éœ€è¦çš„å®¿ä¸»ç¯å¢ƒä¾èµ–ã€‚è¿™äº›ä¾èµ–é€šå¸¸ç”±å®¿ä¸»é¡¹ç›®æä¾›ï¼Œè€Œä¸æ˜¯ç”±å½“å‰åŒ…ç›´æ¥å®‰è£…ã€‚ä¾‹å¦‚ï¼Œ`markdown-it-mathjax3` å’Œ `postcss` æ˜¯ VitePress éœ€è¦çš„åŒè¡Œä¾èµ–ã€‚
- **`peerDependenciesMeta`**ï¼šå¯¹ `peerDependencies` çš„å…ƒä¿¡æ¯è¡¥å……è¯´æ˜ã€‚ä¾‹å¦‚ï¼š
  - å¦‚æœæŸä¸ªåŒè¡Œä¾èµ–æ˜¯å¯é€‰çš„ï¼Œåˆ™ä¼šåœ¨ `peerDependenciesMeta` ä¸­æ ‡è®°ä¸º `"optional": true`ã€‚
  - åœ¨ç¤ºä¾‹ä¸­ï¼Œ`markdown-it-mathjax3` å’Œ `postcss` è¢«æ ‡è®°ä¸ºå¯é€‰ä¾èµ–ï¼Œè¿™æ„å‘³ç€å³ä½¿å®¿ä¸»é¡¹ç›®æ²¡æœ‰å®‰è£…è¿™äº›ä¾èµ–ï¼ŒVitePress ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚
- é€šè¿‡è¿™äº›å­—æ®µï¼Œ`package-lock.json` æä¾›äº†å…³äºä¾èµ–çš„å…¨é¢ä¿¡æ¯ï¼ŒåŒ…æ‹¬å…¶æ¥æºã€ç‰ˆæœ¬ã€è®¸å¯è¯ã€å¯æ‰§è¡Œæ–‡ä»¶ä»¥åŠä¸å…¶ä»–åŒ…çš„å…³ç³»ç­‰ã€‚è¿™äº›ä¿¡æ¯ä¸ä»…æœ‰åŠ©äºç¡®ä¿ä¾èµ–çš„ä¸€è‡´æ€§ï¼Œè¿˜ä¸ºå¼€å‘è€…æä¾›äº†æ¸…æ™°çš„ä¾èµ–ç®¡ç†è§†å›¾ã€‚
- è¡¥å……è¯´æ˜ï¼š
  - ä¾èµ–ä¿¡æ¯æ˜¯ `packages` æˆ– `dependencies` å­—æ®µä¸­çš„å†…å®¹ï¼Œå…·ä½“æ˜¯å•¥ï¼Œå¾—çœ‹ä½ çš„ npm ç‰ˆæœ¬ã€‚
  - ![å›¾ 0](https://cdn.jsdelivr.net/gh/Tdahuyou/imgs@main/2025-04-05-18-09-51.png)

## 5. ğŸ“’ `package-lock.json` ä¼šè‡ªåŠ¨ç”Ÿæˆå’Œæ›´æ–°

- **ç”Ÿæˆ**ï¼šå½“ä½ è¿è¡Œ `npm install` æ—¶ï¼Œå¦‚æœé¡¹ç›®ä¸­æ²¡æœ‰ `package-lock.json` æ–‡ä»¶ï¼Œnpm ä¼šè‡ªåŠ¨ç”Ÿæˆå®ƒã€‚
- **æ›´æ–°**ï¼šå½“æ·»åŠ ã€åˆ é™¤æˆ–æ›´æ–°ä¾èµ–æ—¶ï¼Œ`package-lock.json` ä¼šè‡ªåŠ¨æ›´æ–°ä»¥åæ˜ æœ€æ–°çš„ä¾èµ–æ ‘ã€‚ä¾‹å¦‚ï¼š

```bash
npm install express
npm uninstall lodash
npm update axios
```

- **æ¸…ç†å’Œé‡ç½®**ï¼šå¦‚æœ `package-lock.json` å‡ºç°å†²çªæˆ–æŸåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤é‡æ–°ç”Ÿæˆï¼š

```bash
rm package-lock.json
npm install
```

## 6. ğŸ“’ æ³¨æ„äº‹é¡¹

- **æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ**
  - **å»ºè®®å°† `package-lock.json` æäº¤åˆ° Git ç­‰ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­**ï¼Œä»¥ä¾¿å›¢é˜Ÿæˆå‘˜å’Œ CI/CD ç¯å¢ƒèƒ½å¤Ÿå¤ç°ç›¸åŒçš„ä¾èµ–æ ‘ã€‚
  - å¦‚æœä¸æäº¤ï¼Œå¯èƒ½ä¼šå¯¼è‡´å›¢é˜Ÿæˆå‘˜å®‰è£…çš„ä¾èµ–ç‰ˆæœ¬ä¸ä¸€è‡´ã€‚
  - å¦‚æœä½ çš„é¡¹ç›®æ˜¯ä½¿ç”¨ Git ä½œä¸ºç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼Œä½ è¦åšçš„äº‹å„¿å¾ˆç®€å•ï¼Œä¸è¦åœ¨ `.gitignore` æ–‡ä»¶æ·»åŠ  `package-lock.json` å¿½ç•¥é¡¹å³å¯ã€‚
