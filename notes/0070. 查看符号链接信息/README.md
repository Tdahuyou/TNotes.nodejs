# [0070. æŸ¥çœ‹ç¬¦å·é“¾æ¥ä¿¡æ¯](https://github.com/Tdahuyou/TNotes.nodejs/tree/main/notes/0070.%20%E6%9F%A5%E7%9C%8B%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5%E4%BF%A1%E6%81%AF)

<!-- region:toc -->

- [1. ğŸ“ æ¦‚è¿°](#1--æ¦‚è¿°)
- [2. ğŸ’» demos.1 - å¯¹æ¯”ï¼š`fs.stat` å’Œ `fs.lstat`](#2--demos1---å¯¹æ¯”fsstat-å’Œ-fslstat)

<!-- endregion:toc -->

## 1. ğŸ“ æ¦‚è¿°

- è¦åŒºåˆ†æ™®é€šæ–‡ä»¶ã€ç›®å½•å’Œç¬¦å·é“¾æ¥ï¼Œå¯ä»¥ä½¿ç”¨ `fs.lstat()` æˆ– `fs.lstatSync()` æ–¹æ³•ã€‚
- è¿™äº›æ–¹æ³• **ä¸ä¼šè§£æç¬¦å·é“¾æ¥ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ç¬¦å·é“¾æ¥æœ¬èº«çš„ä¿¡æ¯**ã€‚
- **å¯¹æ¯”ï¼š`fs.stat` å’Œ `fs.lstat`**

| æ–¹æ³• | æ˜¯å¦è§£æç¬¦å·é“¾æ¥ | è¿”å›å€¼æè¿° |
| --- | --- | --- |
| `fs.stat` | æ˜¯ï¼ˆè§£æç¬¦å·é“¾æ¥ï¼‰ | è¿”å›ç¬¦å·é“¾æ¥æŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•çš„çŠ¶æ€ä¿¡æ¯ã€‚ |
| `fs.lstat` | å¦ï¼ˆä¸è§£æç¬¦å·é“¾æ¥ï¼‰ | è¿”å›ç¬¦å·é“¾æ¥æœ¬èº«çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¸ä¼šè§£æç›®æ ‡è·¯å¾„ã€‚ |

- **ğŸ¤” ä»€ä¹ˆå«â€œè§£æç¬¦å·é“¾æ¥â€ï¼Ÿ**
  - **â€œè§£æç¬¦å·é“¾æ¥â€**ï¼šæ–¹æ³•ä¼šè‡ªåŠ¨è·Ÿéšç¬¦å·é“¾æ¥ï¼Œè¿”å›ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•çš„çŠ¶æ€ä¿¡æ¯ã€‚
    - å½“æ“ä½œç³»ç»Ÿæˆ–ç¨‹åºè®¿é—®ä¸€ä¸ªç¬¦å·é“¾æ¥æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šè‡ªåŠ¨è·Ÿéšï¼ˆresolveï¼‰è¿™ä¸ªç¬¦å·é“¾æ¥ï¼Œæ‰¾åˆ°å®ƒæŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•ã€‚è¿™ç§è¡Œä¸ºç§°ä¸ºâ€œè§£æç¬¦å·é“¾æ¥â€ã€‚
    - å‡è®¾æœ‰ä¸€ä¸ªç¬¦å·é“¾æ¥ `exampleLink.txt`ï¼Œå®ƒæŒ‡å‘ç›®æ ‡æ–‡ä»¶ `example.txt`ã€‚
    - å¦‚æœä½ ä½¿ç”¨ `fs.stat()` æˆ– `fs.statSync()` æ–¹æ³•æ£€æŸ¥ `exampleLink.txt`ï¼ŒNode.js ä¼šè‡ªåŠ¨è§£æç¬¦å·é“¾æ¥ï¼Œå¹¶è¿”å›ç›®æ ‡æ–‡ä»¶ `example.txt` çš„çŠ¶æ€ä¿¡æ¯ã€‚
    - æ¢å¥è¯è¯´ï¼Œ`fs.stat()` å’Œ `fs.statSync()` ä¸ä¼šå‘Šè¯‰ä½  `exampleLink.txt` æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œè€Œæ˜¯ç›´æ¥å‘Šè¯‰ä½ å®ƒæŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶çš„çŠ¶æ€ã€‚
    - æ­¤æ—¶ï¼Œä½ å¯ä»¥ç†è§£ä¸º `exampleLink.txt` å°±æ˜¯ `example.txt`ï¼Œå®ƒä»¬æ˜¯ç­‰ä»·çš„ã€‚
  - **â€œä¸ä¼šè§£æç¬¦å·é“¾æ¥â€**ï¼šæ–¹æ³•ä¸ä¼šè·Ÿéšç¬¦å·é“¾æ¥ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ç¬¦å·é“¾æ¥æœ¬èº«çš„çŠ¶æ€ä¿¡æ¯ã€‚
    - æŸäº›æ–¹æ³•ï¼ˆå¦‚ `fs.lstat()` æˆ– `fs.lstatSync()`ï¼‰ä¸ä¼šè‡ªåŠ¨è§£æç¬¦å·é“¾æ¥ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ç¬¦å·é“¾æ¥æœ¬èº«çš„ä¿¡æ¯ã€‚
    - ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬ä¼šå‘Šè¯‰ä½ è·¯å¾„æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œè€Œä¸æ˜¯å»æ£€æŸ¥ç¬¦å·é“¾æ¥æŒ‡å‘çš„ç›®æ ‡ã€‚
    - å‡è®¾æœ‰ä¸€ä¸ªç¬¦å·é“¾æ¥ `exampleLink.txt`ï¼Œå®ƒæŒ‡å‘ç›®æ ‡æ–‡ä»¶ `example.txt`ã€‚
    - å¦‚æœä½ ä½¿ç”¨ `fs.lstat()` æˆ– `fs.lstatSync()` æ–¹æ³•æ£€æŸ¥ `exampleLink.txt`ï¼ŒNode.js ä¼šè¿”å›ç¬¦å·é“¾æ¥æœ¬èº«çš„çŠ¶æ€ä¿¡æ¯ï¼Œè€Œä¸ä¼šå»è§£æå®ƒæŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶ã€‚
    - é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥åŒºåˆ†è·¯å¾„æ˜¯æ™®é€šæ–‡ä»¶ã€ç›®å½•è¿˜æ˜¯ç¬¦å·é“¾æ¥ã€‚
- **æ³¨æ„**ï¼š
  - å¦‚æœä¼ å…¥çš„é“¾æ¥ä¸å­˜åœ¨ï¼Œä¼šæŠ¥é”™ `ENOENT`ã€‚
- **æœ€ä½³å®è·µ**ï¼š
  - å¦‚æœä½ éœ€è¦çŸ¥é“ç¬¦å·é“¾æ¥æŒ‡å‘çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Œå¯ä»¥ä½¿ç”¨ `fs.stat()` æˆ– `fs.statSync()`ã€‚
  - å¦‚æœä½ éœ€è¦åˆ¤æ–­è·¯å¾„æ˜¯å¦æ˜¯ç¬¦å·é“¾æ¥æœ¬èº«ï¼Œåº”è¯¥ä½¿ç”¨ `fs.lstat()` æˆ– `fs.lstatSync()`ã€‚

## 2. ğŸ’» demos.1 - å¯¹æ¯”ï¼š`fs.stat` å’Œ `fs.lstat`

::: code-group

```js [1.cjs]
const fs = require('fs')
const path = require('path')

// å®šä¹‰ç›®æ ‡æ–‡ä»¶å’Œç¬¦å·é“¾æ¥
const targetPath = path.join(__dirname, '1.txt') // ç›®æ ‡æ–‡ä»¶
const linkPath = path.join(__dirname, '1_link.txt') // ç¬¦å·é“¾æ¥

try {
  // åˆ›å»ºç¬¦å·é“¾æ¥
  fs.symlinkSync(targetPath, linkPath)

  // ä½¿ç”¨ fs.statSync æ£€æŸ¥ç¬¦å·é“¾æ¥
  const statResult = fs.statSync(linkPath)
  console.log(`fs.statSync: æ˜¯å¦ä¸ºæ–‡ä»¶: ${statResult.isFile()}`) // true
  console.log(`fs.statSync: æ˜¯å¦ä¸ºç¬¦å·é“¾æ¥: ${statResult.isSymbolicLink()}`) // falseï¼ˆå·²è§£æä¸ºç›®æ ‡æ–‡ä»¶ï¼‰

  // ä½¿ç”¨ fs.lstatSync æ£€æŸ¥ç¬¦å·é“¾æ¥
  const lstatResult = fs.lstatSync(linkPath)
  console.log(`fs.lstatSync: æ˜¯å¦ä¸ºæ–‡ä»¶: ${lstatResult.isFile()}`) // false
  console.log(`fs.lstatSync: æ˜¯å¦ä¸ºç¬¦å·é“¾æ¥: ${lstatResult.isSymbolicLink()}`) // trueï¼ˆæœªè§£æï¼‰
} catch (err) {
  console.error(`æ“ä½œå¤±è´¥: ${err.message}`)
}

// è¾“å‡ºï¼š
// fs.statSync: æ˜¯å¦ä¸ºæ–‡ä»¶: true
// fs.statSync: æ˜¯å¦ä¸ºç¬¦å·é“¾æ¥: false
// fs.lstatSync: æ˜¯å¦ä¸ºæ–‡ä»¶: false
// fs.lstatSync: æ˜¯å¦ä¸ºç¬¦å·é“¾æ¥: true

// âš ï¸
// å¦‚æœç¬¦å·é“¾æ¥ linkPath å·²ç»è¢«åˆ›å»ºï¼Œåˆ™å†æ¬¡åˆ›å»ºä¼šæŠ¥é”™ï¼š
// æ“ä½œå¤±è´¥: EEXIST:
// file already exists, symlink
// '/Users/huyouda/zm/notes/TNotes.nodejs/notes/0070. æŸ¥çœ‹ç¬¦å·é“¾æ¥ä¿¡æ¯/demos/1/1.txt'
// -> '/Users/huyouda/zm/notes/TNotes.nodejs/notes/0070. æŸ¥çœ‹ç¬¦å·é“¾æ¥ä¿¡æ¯/demos/1/1_link.txt'
```

```txt [1.txt]
test
```

```txt [1_link.txt]
test
```

:::

- **`fs.statSync`**ï¼š
  - è‡ªåŠ¨è§£æç¬¦å·é“¾æ¥ï¼Œè¿”å›ç›®æ ‡æ–‡ä»¶ `1.txt` çš„çŠ¶æ€ä¿¡æ¯ã€‚
  - å› æ­¤ï¼Œ`isFile()` è¿”å› `true`ï¼Œ`isSymbolicLink()` è¿”å› `false`ã€‚
- **`fs.lstatSync`**ï¼š
  - ä¸è§£æç¬¦å·é“¾æ¥ï¼Œè¿”å›ç¬¦å·é“¾æ¥æœ¬èº«çš„çŠ¶æ€ä¿¡æ¯ã€‚
  - å› æ­¤ï¼Œ`isFile()` è¿”å› `false`ï¼Œ`isSymbolicLink()` è¿”å› `true`ã€‚
