const fs = require('fs')

const start = Date.now()

function f1() {
  console.log('f1', Date.now() - start)
}

function f2() {
  console.log('f2', Date.now() - readFileStart)
  // æ­»å¾ªçŽ¯ 300ms
  const start = Date.now()
  while (Date.now() - start < 300) {}
}

setTimeout(f1, 200)

const readFileStart = Date.now()
fs.readFile('./1.txt', 'utf-8', f2)

// 1.txt æ–‡ä»¶å†…å®¹ï¼š
// hello world

// è¾“å‡ºï¼š
// f2 2
// f1 306

// æ³¨æ„ï¼š
// è¿™é‡Œçš„ 2 å’Œ 306 ä¹Ÿå¯èƒ½æ˜¯å…¶ä»–å€¼ï¼Œæ¯”å¦‚ 306 ä¹Ÿå¯èƒ½æ˜¯ 304ã€305ã€307ã€308ï¼Œä½†æ˜¯ä¸ä¼šå·®å¤ªå¤šã€‚ï¼ˆé™¤éžä½ çš„è®¡ç®—æœºåœ¨è¿™æ—¶å€™æ°å·§å¡äº†ä¸€ä¸‹ï¼‰

// ðŸ¤” ç¨‹åºæ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ
// 1. setTimeout(f1, 200) ç¨‹åºæ‰§è¡Œåˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œå¯åŠ¨äº†ä¸€ä¸ª 200ms çš„è®¡æ—¶å™¨ï¼Œf1 ä»»åŠ¡ä¼šåœ¨ 200ms åŽè¢«æŽ¨é€åˆ° timers é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œã€‚
// 2. fs.readFile('./1.txt', 'utf-8', f2) ç¨‹åºæ‰§è¡Œåˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œä¼šåŽ»è¯»å– 1.txt æ–‡ä»¶å†…å®¹ï¼Œåœ¨è¯»å–åˆ°æ–‡ä»¶å†…å®¹ä¹‹åŽï¼Œä¼šå°† f2 æŽ¨é€åˆ° poll é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œã€‚
//    fs.readFile å®Œæˆæ–‡ä»¶è¯»å–åŽï¼Œf2 è¢«æ”¾å…¥ poll äº‹ä»¶é˜Ÿåˆ—åŽä¼šç«‹å³æ‰§è¡Œã€‚
//    è¿™ä¸ªè¯»å–æ–‡ä»¶å†…å®¹çš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œå†…å®¹ä¹Ÿå°±ä¸€è¡Œâ€œhello worldâ€ï¼Œè€—æ—¶æžçŸ­ï¼Œä»Žæ‰“å°ç»“æžœæ¥çœ‹ï¼Œä¹Ÿå°± 2msï¼Œå®ƒæ˜¯æ˜Žæ˜¾å°äºŽ 200ms çš„å°±å¯¹äº†ã€‚
//    è¿™å°±æ„å‘³ç€ f2 ä¼šå…ˆè¢«ä¸¢åˆ° poll é˜Ÿåˆ—ä¸­ã€‚
//    æ­¤æ—¶å…¶å®ƒé˜Ÿåˆ—éƒ½æ˜¯ç©ºï¼Œevent loop æ­£åœåœ¨ poll é˜Ÿåˆ—ä¸­ç­‰ç€ï¼Œè¿™ä¸ª f2 ä»»åŠ¡ä¸€æ—¦è¢«æŽ¨é€è¿›åŽ»ï¼Œå°±ä¼šç«‹åˆ»è¢«æ‰§è¡Œã€‚
// 3. f2 ä¸­çš„æ­»å¾ªçŽ¯é˜»å¡žäº† Node.js çš„æ‰§è¡Œçº¿ç¨‹çº¦ 300msï¼Œå¯¼è‡´åŽç»­ä»»åŠ¡æ— æ³•æ‰§è¡Œã€‚å³ä¾¿ 200ms çš„æ—¶é—´æ—©å°±åˆ°äº†ï¼Œf1 å·²ç»è¢«æŽ¨é€åˆ° timers é˜Ÿåˆ—ä¸­äº†ã€‚
//    setTimeout çš„å›žè°ƒ f1 åœ¨ 200ms æ—¶å·²åˆ°è¾¾å®šæ—¶å™¨æ—¶é—´ï¼Œä½†å¿…é¡»ç­‰å¾… Node.js çš„æ‰§è¡Œçº¿ç¨‹æŠŠ f2 æ‰§è¡Œå®Œæ¯•åŽæ‰å¯èƒ½è½®åˆ°å®ƒã€‚
//    å› æ­¤ï¼Œf2 å…ˆè¾“å‡ºï¼Œf1 åœ¨ f2 æ‰§è¡Œå®Œæ¯•åŽè¾“å‡ºï¼Œä¸” f1 åŽè·Ÿçš„æ—¶é—´ä¸ºå®žé™…æ‰§è¡Œæ—¶çš„å»¶è¿Ÿï¼ˆçº¦ 306msï¼‰ã€‚
